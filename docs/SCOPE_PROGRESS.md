# ゴールデン四柱推命アプリケーション 開発進捗状況

## 📊 プロジェクト進捗率
**現在の進捗**: 2/22 ステップ完了 (9.1%)

## 実装計画と環境設定
ゴールデン四柱推命アプリケーションの開発は以下のフローに沿って進行します：

| ステップ | 状態 | 解説 |
|---------|------|------|
| 0. プロジェクト作成 | ✅ 完了 | 🚀 あなたの夢の第一歩！プロジェクトの土台を整え、これから始まる冒険の準備が整いました |
| 1. 要件定義のヒアリング | ✅ 完了 | 💡 あなたのアイデアを形に！ゴールドテーマ・五行カラー・6ページ構成の詳細確定 |
| 2. 要件定義書の作成 | ✅ 完了 | 📋 夢を設計図に変換！CAIP法による詳細な要件定義書作成完了 |
| 3. 4つのデザイン候補作成 | ⬜ 未開始 | 🎨 ワクワクする瞬間！4つの魅力的なデザインからあなた好みの一つを選べます |
| 4. デザインシステム作成 | ⬜ 未開始 | 🎯 統一感のある美しさを！ゴールドテーマ・五行カラーを全体に行き渡らせます |
| 5. 全モックアップ作成 | ⬜ 未開始 | 👀 ついに姿が見えてきた！実際の画面イメージで夢が現実味を帯びてきます |
| 6. モックアップフィードバック | ⬜ 未開始 | ✨ ユーザー体験の最適化！フィードバックを基にさらに磨き上げます |
| 7. 環境変数設定 | ⬜ 未開始 | 🔑 3つの環境を整備！.env.local/.env.staging/.env.productionを設定します |
| 8. 実装計画策定 | ⬜ 未開始 | 📅 成功への道筋を描く！並列実行可能なPhase分けと実装ロードマップを作成します |
| 9. データモデル設計 | ⬜ 未開始 | 🗃️ データの基盤構築！SQLAlchemyモデルとマイグレーションを作成します |
| 10. API契約定義 | ⬜ 未開始 | 📄 FastAPIエンドポイント設計！Pydanticスキーマで型安全な契約を作成します |
| 11. サービス層実装 | ⬜ 未開始 | ⚙️ ビジネスロジック構築！既存コードを統合して実データで動作する処理を作成 |
| 12. テスト動作保証 | ⬜ 未開始 | ✅ 実データ主義！モックなしで全テストを通過させます |
| 13. 品質検証 | ⬜ 未開始 | 🛡️ 品質の守護者！誤魔化しのない本物の動作を検証します |
| 14. 連鎖APIテスト | ⬜ 未開始 | 🔗 エンドツーエンド検証！複数APIの連携動作をテストします |
| 15. 連鎖API動作保証 | ⬜ 未開始 | 🎯 統合動作の確認！実際のユーザーフローで動作を保証します |
| 16. 環境セットアップ&基盤構築 | ⬜ 未開始 | 🏗️ フロントエンド基盤！OpenAPI接続とルーティング設定を構築します |
| 17. フロントエンド実装 | ⬜ 未開始 | 🎭 画面実装！モックアップとAPIを統合してゴールドテーマで機能するページを作成 |
| 18. ブラウザ動作検証 | ⬜ 未開始 | 🌐 Playwright検証！実際のブラウザで全エンドポイントの動作を確認します |
| 19. デプロイ環境構築 | ⬜ 未開始 | 🚀 3環境構築！本番・ステージング・開発環境を整備します |
| 20. CI/CD構築 | ⬜ 未開始 | ⚡ 自動化の魔法！GitHub Actionsで継続的デプロイを実現します |
| 21. 認証機能追加 | ⬜ 未開始 | 🔐 セキュア機能！JWT + Refresh Token による自動ログイン実装 |


### 統合ページ管理表

| ID | ページ名 | ルート | 権限レベル | 統合機能 | モックアップ | フロントエンド実装 |
|----|---------|-------|----------|---------|------------|-------------------|
| P-001 | 命式記入（トップ） | `/` | 全員 | 入力・計算・保存・golden-peppaアニメーション | [ ] | [ ] |
| P-002 | 命式リスト | `/list` | 全員 | 一覧・検索・管理・五行カラー・吉凶アイコン | [ ] | [ ] |
| P-003 | 命式詳細・グラフ | `/detail/:id` | 全員 | 四柱・大運・年月日運・人生グラフ(Recharts)・詳細分析 | [ ] | [ ] |
| P-004 | 設定 | `/settings` | 全員 | アカウント・データ・自動ログイン設定 | [ ] | [ ] |
| P-AUTH-1 | ログイン | `/login` | ゲストのみ | メール＋パスワード認証・セッション保持 | [ ] | [ ] |
| P-AUTH-2 | 新規登録 | `/register` | ゲストのみ | アカウント作成・ゲストデータ移行 | [ ] | [ ] |

### バックエンド進捗表（FastAPIエンドポイント単位）

| 番号 | エンドポイント | HTTPメソッド | 説明 | 対応ページ | 実装 | テスト |
|------|--------------|-------------|------|----------|------|--------|
| 1.1 | `/api/saju/calculate` | POST | 命式計算（lunar-python + 210年節気DB） | P-001 | [ ] | [ ] |
| 1.2 | `/api/saju/save` | POST | 命式保存（LocalStorage or PostgreSQL） | P-001 | [ ] | [ ] |
| 2.1 | `/api/saju/list` | GET | 命式一覧取得 | P-002 | [ ] | [ ] |
| 2.2 | `/api/saju/{id}` | DELETE | 命式削除 | P-002 | [ ] | [ ] |
| 3.1 | `/api/saju/{id}` | GET | 命式詳細取得 | P-003 | [ ] | [ ] |
| 3.2 | `/api/saju/{id}/daeun` | GET | 大運分析・人生グラフデータ | P-003 | [ ] | [ ] |
| 3.3 | `/api/saju/{id}/current` | GET | 現在の年運・月運・日運 | P-003 | [ ] | [ ] |
| 4.1 | `/api/user/password` | PUT | パスワード変更 | P-004 | [ ] | [ ] |
| 4.2 | `/api/saju/export` | GET | データエクスポート | P-004 | [ ] | [ ] |
| 4.3 | `/api/saju/import` | POST | データインポート | P-004 | [ ] | [ ] |
| 5.1 | `/api/auth/login` | POST | ログイン（JWT発行） | P-AUTH-1 | [ ] | [ ] |
| 5.2 | `/api/auth/register` | POST | 新規登録 | P-AUTH-2 | [ ] | [ ] |
| 5.3 | `/api/saju/migrate` | POST | ゲストデータ移行 | P-AUTH-2 | [ ] | [ ] |

### API連鎖テスト定義表

| 連鎖テストID | スライス名 | ユーザーストーリー | エンドポイント連鎖 | 外部依存 | 実装優先度 | 作成 | テスト通過 | 品質担保 |
|------------|---------|-----------------|------------------|---------|----------|------|----------|----------|
| CHAIN-001 | 命式計算全体フロー | 生年月日時入力して正確な命式を確認 | 1.1→1.2 | lunar-python, 210年節気DB | 最高 | [ ] | [ ] | [ ] |
| CHAIN-002 | 人生グラフ生成 | 命式から大運ベースの折れ線グラフを表示 | 1.1→3.1→3.2 | Recharts, 天干・地支マトリックス | 最高 | [ ] | [ ] | [ ] |
| CHAIN-003 | 年月日運分析 | 現在の運勢を詳細に確認 | 1.1→3.1→3.3 | lunar-python, 吉凶判定ロジック | 高 | [ ] | [ ] | [ ] |
| CHAIN-004 | ゲスト→ログイン移行 | ゲストデータをクラウドに移行 | 5.2→5.3→2.1 | PostgreSQL | 高 | [ ] | [ ] | [ ] |
| CHAIN-005 | データ管理統合 | 命式一覧・削除・エクスポート | 2.1→2.2→4.2 | PostgreSQL | 中 | [ ] | [ ] | [ ] |

## 📝 プロジェクト固有ルール

### 四柱推命計算の正確性（最重要）
- **210年節気データベース（1900-2109年）必須活用**
- lunar-pythonを利用した万年暦計算
- 性別別大運計算（男性：順行、女性：逆行）
- 節入日基準の正確な月柱計算
- **データロジック100%正確性を最優先**

### ドンサゴン分析法準守
- 調候用神 80% : 原局 20% 比重
- 天干マトリックス100個組合せ活用
- 地支調候表144個組合せ活用
- **絶対禁止**: 五行論、十神論、身強・身弱論
- **必須原則**: 用神=武器、日支の合は無条件吉、天干の合は基本的に凶

### デザインシステム
- **ゴールドテーマ**: #D4AF37をメインアクセントカラー
- **五行カラーシステム**:
  - 木: #4CAF50（緑）
  - 火: #F44336（赤）
  - 土: #FFB300（黄/オレンジ）
  - 金: #BDBDBD（グレー/白）
  - 水: #424242（黒/ダークグレー）
- **吉凶カラーシステム**:
  - 大吉: #FFD700（ゴールド）
  - 吉: #4CAF50（緑）
  - 平: #9E9E9E（グレー）
  - 凶: #FF9800（オレンジ）
  - 大凶: #F44336（赤）
- **golden-peppaアニメーション統合**（ローディング・キラキラエフェクト）

### ゲスト/ログインモード両立
- **ゲストモード**: ログイン不要、LocalStorageのみ、その端末限定
- **ログインモード**: メール＋パスワード、PostgreSQL、複数端末同期
- **自動ログイン**: JWT + Refresh Token（7日/30日/無期限選択）
- **データ移行**: ゲスト→ログイン時にLocalStorageデータをクラウドにアップロード可能

## 🔧 技術スタック

### フロントエンド
- React 18 + TypeScript 5 + Vite 5
- MUI v6（ゴールドテーマカスタマイズ）
- Recharts v3.3.0（人生グラフ）
- Zustand（状態管理）
- React Router v6
- React Query (TanStack Query)
- Vercel（ホスティング）

### バックエンド
- FastAPI 0.100+ + Python 3.11+
- SQLAlchemy 2.0 + Alembic
- Pydantic v2（データ検証）
- FastAPI-Users + JWT（認証）
- lunar-python（万年暦計算）
- 既存資産100%再利用（210年節気DB、天干・地支マトリックス、ドンサゴン分析エンジン）
- GCP Cloud Run（ホスティング）

### データベース
- PostgreSQL 15+ (Neon)
- Redis (Upstash, オプション)

## 📌 重要な決定事項

1. **既存検証済みコードベース最大活用**: 210年節気DB、天干・地支マトリックス、ドンサゴン分析アルゴリズム
2. **ゴールドテーマ＋五行カラーシステム**: エレガントで高級感のあるUI
3. **ゲスト/ログインモード両立**: ログイン不要ですぐ使える＋クラウド同期も可能
4. **データ正確性最優先**: 計算ロジック100%正確、速度よりも正確性
5. **6ページのシンプル設計**: トップが命式記入、ログイン不要で即使える

## 🎯 次のステップ

次は **Step#8: SCOPE_PROGRESSへの進捗表挿入** および **Step#9: CLAUDE.md生成** です。

---

**最終更新**: 2025年11月1日
**プロジェクト名**: ゴールデン四柱推命アプリケーション
**コンセプト**: あなたの運命に魔法をかける
