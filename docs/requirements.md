# ゴールデン四柱推命アプリケーション - 要件定義書

## 要件定義の作成原則
- **「あったらいいな」は絶対に作らない**
- **拡張可能性のための余分な要素は一切追加しない**
- **将来の「もしかして」のための準備は禁止**
- **今、ここで必要な最小限の要素のみ**

---

## 1. プロジェクト概要

### 1.1 成果目標
既存の210年節気データベース（1900-2109年）と検証済み万年暦計算システムを統合し、ゴールドテーマの美しいUIで四柱推命・大運・年月日運を網羅的に分析し、5段階吉凶判定と折れ線グラフで視覚化する個人利用型四柱推命Webアプリケーション。

**コンセプト**: 「ゴールデン四柱推命 - あなたの運命に魔法をかける」

### 1.2 成功指標

#### 定量的指標
- 命式計算の正確性：100%（210年データベース検証済み）
- 複数の命式を保存・管理できる（最低20件以上）
- 大運・年運・月運・日運すべてを1画面で確認可能
- 人生グラフ（大運ベース折れ線）の生成時間5秒以内
- 吉凶判定5段階（大吉・吉・平・凶・大凶）で明確に表示
- ローディングアニメーションの完全統合
- API応答時間：2秒以内
- ページ総数：6ページ（シンプル設計）

#### 定性的指標
- 誰でも簡単に命式を記入・保存できる
- ゴールドテーマで高級感とエレガンスを感じられる
- キラキラエフェクトで魔法をかけるような体験
- 複雑な運勢情報が視覚的にわかりやすい
- 五行カラーシステムで命式が一目瞭然
- 人生の波が美しいグラフで一目瞭然
- ログイン不要で即座に使える（ゲストモード）
- ログインすれば複数端末で同期可能
- ダウンロード後、個人環境で利用可能

---

## 2. システム全体像

### 2.1 主要機能一覧

#### カテゴリ1：命式管理
- 生年月日時入力と自動計算
- 複数命式の保存・編集・削除
- 命式一覧表示・検索・フィルタ

#### カテゴリ2：運勢分析
- 四柱推命表示（五行カラー統合）
- 大運分析（10年周期）
- 年運・月運・日運分析
- 5段階吉凶判定（大吉・吉・平・凶・大凶）
- 人生グラフ（大運ベース折れ線）

#### カテゴリ3：ユーザー管理
- ゲストモード（ローカルストレージ）
- ログインモード（クラウドDB同期）
- 自動ログイン機能（セッション保持）
- ゲスト→ログインユーザー移行

#### カテゴリ4：デザイン・UX
- ゴールドテーマ統合
- golden-peppaアニメーション
- キラキラエフェクト
- レスポンシブ対応

### 2.2 ユーザーロールと権限

#### ゲストユーザー
- **認証**: 不要
- **データ保存**: ローカルストレージのみ
- **アクセス範囲**: その端末のみ
- **アクセス可能な機能**:
  - 命式記入・計算・保存（ローカル）
  - 命式リスト表示（ローカルデータのみ）
  - 命式詳細・グラフ表示
  - 設定（限定機能）
- **制限**: 複数端末での同期不可、データはその端末のみ

#### ログインユーザー
- **認証**: メールアドレス＋パスワード
- **データ保存**: PostgreSQL（クラウドDB）
- **アクセス範囲**: どの端末からでもOK（Web・アプリ両対応）
- **アクセス可能な機能**:
  - すべてのゲスト機能
  - クラウドDB同期
  - 複数端末でのデータ共有
  - 自動ログイン（セッション保持）
  - データエクスポート/インポート
- **特典**: データバックアップ、永続保存

#### 管理者
- **不要**（個人利用のため）

### 2.3 認証・認可要件

#### 認証方式
- **メールアドレス＋パスワード**（ログインモードのみ）
- **ゲストモードは認証スキップ**

#### セッション管理
- **方式**: JWT (Access Token) + Refresh Token
- **Access Token**: 有効期限15分、API呼び出し時の認証
- **Refresh Token**: 有効期限7日/30日/無期限（ユーザー選択）
- **自動ログイン**: Refresh Tokenが有効なら自動認証
- **セキュリティ**: Refresh Token rotation、デバイス制限

#### セキュリティレベル
- **ゲストモード**: なし（ローカルのみ）
- **ログインモード**: 中レベル
  - パスワードハッシュ化（bcrypt）
  - HTTPS通信必須
  - user_id によるデータ分離
  - CORS設定
  - Rate Limiting

#### 管理機能
- **必要性**: 不要
- **理由**: 個人利用、ユーザー自身が全権限、管理画面不要

---

## 3. ページ詳細仕様

### 3.1 P-001: 命式記入ページ（トップページ）

#### ルート
`/`（ルートパス）

#### 権限
全員（ゲスト/ログインユーザー共通）

#### 目的
アプリを開いてすぐに命式を入力・計算できる。ログイン不要で即座に使える体験を提供。

#### 主要機能
- **初回訪問時**: ゴールドアニメーション表示（golden-peppa、短時間）
- **生年月日時入力フォーム**:
  - 西暦入力（1900-2109年）
  - 月・日・時・分の選択
- **性別選択**: 男性/女性（大運計算に必須）
- **名前入力**: 任意、管理用ラベル
- **「命式を計算」ボタン**: クリック時にキラキラエフェクト
- **ローディング表示**: golden-peppaアニメーション
- **計算結果プレビュー**:
  - 四柱表示（五行カラー）
  - 簡易吉凶表示
- **「保存」ボタン**: ゲストモードはローカル、ログインモードはクラウドDB
- **ヘッダー**:
  - 左: 「保存した命式」リンク（→P-002）
  - 右: ゲストモード「ログイン/登録」、ログインモード「設定」

#### 必要な操作（FastAPI）

| 操作種別 | エンドポイント | HTTPメソッド | 必要な入力 | 期待される出力 |
|---------|--------------|-------------|-----------|---------------|
| 計算 | `/api/saju/calculate` | POST | BirthDataRequest | SajuResponse |
| 保存 | `/api/saju/save` | POST | SajuData + user_id | SaveResponse |

#### 処理フロー
1. ユーザーが生年月日時・性別・名前を入力
2. 「命式を計算」ボタンクリック
3. ローディングアニメーション表示
4. バックエンドで四柱推命計算（lunar-python + 210年節気DB）
5. 大運計算（性別別、節入日ベース）
6. 5段階吉凶判定（天干・地支マトリックス）
7. 結果をプレビュー表示（五行カラー）
8. 「保存」で LocalStorage または PostgreSQL に保存

#### データ構造（Pydantic）
```python
class BirthDataRequest(BaseModel):
    birth_datetime: datetime
    gender: Literal['male', 'female']
    name: Optional[str] = None
    timezone_offset: int = 9  # KST

class SajuResponse(BaseModel):
    id: str
    name: Optional[str]
    birth_datetime: datetime
    gender: str
    year_stem: str
    year_branch: str
    month_stem: str
    month_branch: str
    day_stem: str
    day_branch: str
    hour_stem: str
    hour_branch: str
    daeun_list: List[DaeunInfo]
    fortune_level: str  # 大吉/吉/平/凶/大凶
    created_at: datetime
```

---

### 3.2 P-002: 命式リストページ

#### ルート
`/list`

#### 権限
全員（ゲスト/ログインユーザー共通）

#### 目的
保存した命式を一覧表示し、素早くアクセス・管理できる。

#### 主要機能
- **命式カード一覧表示**:
  - カード形式（Grid Layout）
  - 各カードに表示:
    - 名前（または「無題」）
    - 生年月日
    - 四柱プレビュー（五行カラー）
    - 簡易吉凶アイコン（5段階）
  - ホバー時: キラキラエフェクト、カードが浮く
- **検索機能**: 名前・生年月日で検索
- **フィルタ機能**: 吉凶レベル別、性別
- **ソート機能**: 作成日、名前、生年月日
- **「新規作成」ボタン**: ゴールドカラー、クリックで→P-001
- **各カードのアクション**:
  - 「詳細」→P-003
  - 「編集」→P-001（編集モード）
  - 「削除」（確認ダイアログ付き）
- **ゲストモード専用バナー**:
  - 「アカウント作成でクラウドに保存！」
  - クリックで→P-AUTH-2

#### 必要な操作（FastAPI）

| 操作種別 | エンドポイント | HTTPメソッド | 必要な入力 | 期待される出力 |
|---------|--------------|-------------|-----------|---------------|
| 一覧取得 | `/api/saju/list` | GET | user_id（ログイン時） | List[SajuSummary] |
| 削除 | `/api/saju/{id}` | DELETE | id, user_id | DeleteResponse |

#### 処理フロー
1. ページロード時、ゲストモードはLocalStorageから、ログインモードはPostgreSQLから命式リスト取得
2. カード形式で一覧表示（五行カラー、吉凶アイコン）
3. 検索・フィルタ・ソート機能で絞り込み
4. カードクリックで詳細ページへ遷移
5. 削除時は確認ダイアログ表示後、削除実行

---

### 3.3 P-003: 命式詳細・グラフ表示ページ

#### ルート
`/detail/:id`

#### 権限
全員（ゲスト/ログインユーザー共通）

#### 目的
選択した命式の全情報を表示し、四柱・大運・年月日運・人生グラフを統合的に分析。

#### 主要機能

##### セクション1：基本情報
- 名前、生年月日時、性別
- 「編集」「削除」「リストに戻る」ボタン

##### セクション2：四柱表示
- **年柱・月柱・日柱・時柱**: 縦または横配置
- **天干・地支を五行カラーで表示**:
  - 木（甲・乙・寅・卯・辰）: 緑色系 (#4CAF50)
  - 火（丙・丁・巳・午・未）: 赤色系 (#F44336)
  - 土（戊・己・辰・戌・丑・未）: 黄色/オレンジ系 (#FFB300)
  - 金（庚・辛・申・酉・戌）: 白/グレー系 (#BDBDBD)
  - 水（壬・癸・亥・子・丑）: 黒/ダークグレー系 (#424242)
- **五行バランス表示**: 木火土金水の個数

##### セクション3：大運表示
- **10年周期の大運一覧**: テーブルまたはタイムライン形式
- **各大運期の情報**:
  - 年齢範囲（例：8-17歳）
  - 天干・地支（五行カラー）
  - 吉凶レベル（5段階アイコン）
- **現在の大運ハイライト**: ゴールド枠

##### セクション4：年運・月運・日運
- **現在の年運・月運・日運**:
  - 天干・地支（五行カラー）
  - 吉凶レベル（5段階）
  - 簡易解説文

##### セクション5：人生グラフ
- **Recharts折れ線グラフ**:
  - 横軸: 年齢（0-100歳）
  - 縦軸: 吉凶レベル（1-5）
  - データポイント: 大運ごと（10年間隔）
  - 線の色: ゴールドグラデーション
  - マーカー: 各大運期にゴールドドット
  - ツールチップ: ホバー時に詳細情報（年齢、大運、吉凶レベル）
  - グリッド: 薄いグレー
  - レスポンシブ対応
- **現在位置マーカー**: 縦線で現在年齢を示す

##### セクション6：詳細分析
- **天干マトリックス分析**: 各柱間の関係性（吉凶判定）
- **地支調候表分析**: 季節と地支の関係
- **ドンサゴン解釈文**: 総合的な運勢解説

#### 必要な操作（FastAPI）

| 操作種別 | エンドポイント | HTTPメソッド | 必要な入力 | 期待される出力 |
|---------|--------------|-------------|-----------|---------------|
| 詳細取得 | `/api/saju/{id}` | GET | id, user_id | SajuDetailResponse |
| 大運分析 | `/api/saju/{id}/daeun` | GET | id, user_id | DaeunAnalysisResponse |
| 年月日運 | `/api/saju/{id}/current` | GET | id, user_id, date | CurrentFortuneResponse |

#### 処理フロー
1. ページロード時、命式IDでデータ取得
2. 基本情報・四柱表示（五行カラー適用）
3. 大運計算結果を表示（5段階吉凶判定）
4. 現在日時で年運・月運・日運を計算・表示
5. Rechartsで人生グラフを描画（大運ベース）
6. 天干マトリックス・地支調候表で詳細分析
7. ドンサゴン解釈文を生成・表示

#### データ構造（Pydantic）
```python
class SajuDetailResponse(BaseModel):
    # 基本情報
    id: str
    name: Optional[str]
    birth_datetime: datetime
    gender: str

    # 四柱
    year_stem: str
    year_branch: str
    month_stem: str
    month_branch: str
    day_stem: str
    day_branch: str
    hour_stem: str
    hour_branch: str

    # 大運
    daeun_list: List[DaeunInfo]

    # グラフデータ
    life_graph_data: List[GraphDataPoint]

    # 詳細分析
    tengan_analysis: Dict[str, str]
    jiji_analysis: Dict[str, str]
    interpretation: str

class GraphDataPoint(BaseModel):
    age: int
    fortune_level: int  # 1-5
    daeun_stem: str
    daeun_branch: str
    label: str  # "8-17歳: 甲子"
```

---

### 3.4 P-004: 設定ページ

#### ルート
`/settings`

#### 権限
全員（ゲスト/ログインユーザー、機能差あり）

#### 目的
アプリ設定とアカウント管理

#### 主要機能

##### セクション1：アカウント設定（ログインユーザーのみ）
- **メールアドレス表示**: 変更不可（将来対応）
- **パスワード変更**: フォーム表示
- **ログアウトボタン**: クリックでログアウト、ゲストモードに移行

##### セクション2：データ管理
- **ゲストモード**:
  - 「アカウント作成してクラウドに保存」ボタン
  - クリックで→P-AUTH-2（ゲストデータ移行オプション付き）
- **ログインモード**:
  - データエクスポート（JSON形式）
  - データインポート（バックアップから復元）

##### セクション3：自動ログイン設定（ログインユーザーのみ）
- **「ログイン状態を保持」トグル**: ON/OFF
- **セッション有効期限選択**:
  - 7日間
  - 30日間
  - 無期限

##### セクション4：表示設定
- **テーマ選択**: ゴールド（固定、将来的に他テーマ対応）
- **言語設定**: 日本語（固定、将来的に多言語対応）

##### セクション5：アプリ情報
- **バージョン情報**: v1.0.0
- **利用規約**: リンク（将来作成）
- **プライバシーポリシー**: リンク（将来作成）

#### 必要な操作（FastAPI）

| 操作種別 | エンドポイント | HTTPメソッド | 必要な入力 | 期待される出力 |
|---------|--------------|-------------|-----------|---------------|
| パスワード変更 | `/api/user/password` | PUT | old_password, new_password | UpdateResponse |
| データエクスポート | `/api/saju/export` | GET | user_id | JSON File |
| データインポート | `/api/saju/import` | POST | JSON File | ImportResponse |

---

### 3.5 P-AUTH-1: ログインページ

#### ルート
`/login`

#### 権限
ゲストのみ

#### 目的
ユーザー認証、クラウドDB同期の入口

#### 主要機能
- **メールアドレス入力フォーム**
- **パスワード入力フォーム**
- **「ログイン状態を保持」チェックボックス**: デフォルトON
- **「ログイン」ボタン**: ゴールドカラー
- **「パスワードを忘れた」リンク**: 将来対応
- **「新規登録はこちら」リンク**: →P-AUTH-2

#### 必要な操作（FastAPI）

| 操作種別 | エンドポイント | HTTPメソッド | 必要な入力 | 期待される出力 |
|---------|--------------|-------------|-----------|---------------|
| ログイン | `/api/auth/login` | POST | email, password | TokenResponse |

#### 処理フロー
1. メール・パスワード入力
2. 「ログイン状態を保持」チェック確認
3. 「ログイン」クリック
4. バックエンドで認証（bcryptでパスワード検証）
5. Access Token + Refresh Token発行
6. トークンをLocalStorageに保存
7. P-002（命式リスト）にリダイレクト

---

### 3.6 P-AUTH-2: 新規登録ページ

#### ルート
`/register`

#### 権限
ゲストのみ

#### 目的
アカウント作成、ゲストデータ移行

#### 主要機能
- **メールアドレス入力フォーム**
- **パスワード入力フォーム**（確認入力含む）
- **「ゲストデータを移行する」チェックボックス**: LocalStorageのデータをクラウドにアップロード
- **「登録」ボタン**: ゴールドカラー
- **「ログインはこちら」リンク**: →P-AUTH-1

#### 必要な操作（FastAPI）

| 操作種別 | エンドポイント | HTTPメソッド | 必要な入力 | 期待される出力 |
|---------|--------------|-------------|-----------|---------------|
| 新規登録 | `/api/auth/register` | POST | email, password | TokenResponse |
| データ移行 | `/api/saju/migrate` | POST | user_id, local_data | MigrateResponse |

#### 処理フロー
1. メール・パスワード入力
2. 「ゲストデータを移行する」チェック確認
3. 「登録」クリック
4. バックエンドでアカウント作成（パスワードハッシュ化）
5. Access Token + Refresh Token発行
6. ゲストデータ移行オプションがONの場合:
   - LocalStorageからデータ取得
   - PostgreSQLにアップロード
7. P-002（命式リスト）にリダイレクト

---

## 4. データ設計概要

### 4.1 主要エンティティ

```yaml
User（ユーザー）:
  概要: ログインユーザーのアカウント情報
  主要属性:
    - id（UUID、主キー）
    - email（メールアドレ、一意）
    - hashed_password（ハッシュ化パスワード）
    - created_at（作成日時）
    - updated_at（更新日時）
  関連:
    - SajuCalculation（1対多）

SajuCalculation（命式データ）:
  概要: 四柱推命の計算結果と基本情報
  主要属性:
    - id（UUID、主キー）
    - user_id（外部キー、NULL許可：ゲストモード対応）
    - name（名前、任意）
    - birth_datetime（生年月日時）
    - gender（性別）
    - year_stem, year_branch（年柱）
    - month_stem, month_branch（月柱）
    - day_stem, day_branch（日柱）
    - hour_stem, hour_branch（時柱）
    - fortune_level（吉凶レベル、5段階）
    - created_at（作成日時）
    - updated_at（更新日時）
  関連:
    - User（多対1）
    - DaeunInfo（1対多）

DaeunInfo（大運情報）:
  概要: 大運の詳細情報（10年周期）
  主要属性:
    - id（自動採番、主キー）
    - saju_id（外部キー）
    - start_age（開始年齢）
    - end_age（終了年齢）
    - daeun_stem（大運天干）
    - daeun_branch（大運地支）
    - fortune_level（吉凶レベル、5段階）
  関連:
    - SajuCalculation（多対1）

SolarTerm（節気データ）:
  概要: 210年節気データベース（1900-2109年）
  主要属性:
    - id（自動採番、主キー）
    - year（年）
    - term_name（節気名）
    - exact_datetime（正確な節入日時）
    - longitude（太陽黄経）
  関連: なし（参照専用）

CheonganMatrix（天干マトリックス）:
  概要: 天干100マトリックス（10×10）
  主要属性:
    - id（自動採番、主キー）
    - stem1（天干1）
    - stem2（天干2）
    - compatibility_type（吉凶タイプ）
    - description（説明）
    - score（スコア、1-5）
  関連: なし（参照専用）

JijiMatrix（地支マトリックス）:
  概要: 地支144マトリックス（12×12）
  主要属性:
    - id（自動採番、主キー）
    - branch1（地支1）
    - branch2（地支2）
    - compatibility_type（吉凶タイプ）
    - description（説明）
    - score（スコア、1-5）
  関連: なし（参照専用）
```

### 4.2 エンティティ関係図
```
User ─┬─ SajuCalculation ─┬─ DaeunInfo
      │                    │
      │                    └─ (参照) SolarTerm
      │                    └─ (参照) CheonganMatrix
      │                    └─ (参照) JijiMatrix
      │
      └─ (NULL許可: ゲストモード)
```

### 4.3 バリデーションルール

```yaml
生年月日時:
  - ルール: 1900-2109年の範囲内
  - 理由: 210年節気データベースの範囲

性別:
  - ルール: 'male' または 'female'
  - 理由: 大運計算に必須

メールアドレス:
  - ルール: 有効なメール形式、一意
  - 理由: ログイン認証に使用

パスワード:
  - ルール: 8文字以上
  - 理由: セキュリティ確保

吉凶レベル:
  - ルール: 1-5の整数
  - 理由: 5段階（大凶・凶・平・吉・大吉）
```

---

## 5. 制約事項

### 外部ライブラリ制限
- **lunar-python**: 1900-2100年範囲サポート（210年データベースは2109年まで対応）
- **PostgreSQL**: 同時接続制限あり（Neon無料枠: 1接続）

### 技術的制約
- **データ正確性**: 210年節気データベース範囲内（1900-2109年）でのみ100%正確
- **計算複雑度**: 大運・年月日運・グラフ計算で応答時間が増加する可能性
- **ローカルストレージ**: ブラウザデータクリアで消失

### ドンサゴン分析の絶対禁止事項
- ❌ 五行論（木火土金水、相生相剋）使用禁止
- ❌ 十神論（偏印、正財等）使用禁止
- ❌ 身強・身弱論使用禁止
- ❌ 年柱での用神抽出禁止
- ❌ 月地支は用神不可

### ドンサゴン分析の必須原則
- ✅ 用神 = 武器（不足を補うものではない）
- ✅ 日支の合は無条件吉
- ✅ 調候用神 80% : 原局 20%
- ✅ 天干の合は基本的に凶
- ✅ 月地支は用神不可

---

## 6. 複合API処理（バックエンド内部処理）

### 複合処理-001: 完全命式計算プロセス
**トリガー**: ユーザーが「命式を計算」ボタンクリック
**フロントエンドAPI**: `POST /api/saju/calculate`
**バックエンド内部処理**:
1. lunar-pythonで基本八字計算
2. 210年節気DBで正確な節入日確認
3. 月柱補正（節気境界チェック）
4. 大運計算（性別別、節入日ベース）
5. 天干マトリックス照合（吉凶判定）
6. 地支調候表照合（季節考慮）
7. 総合吉凶レベル算出（5段階）
**結果**: 完全な命式データ（四柱・大運・吉凶）
**外部サービス依存**: lunar-python, PostgreSQL（210年節気DB）

### 複合処理-002: 人生グラフデータ生成
**トリガー**: 命式詳細ページ（P-003）ロード
**フロントエンドAPI**: `GET /api/saju/{id}/daeun`
**バックエンド内部処理**:
1. 命式データ取得
2. 大運リスト取得（10年周期）
3. 各大運期の吉凶レベル計算
4. グラフデータポイント生成（年齢・吉凶レベル）
5. 現在年齢の算出とマーキング
**結果**: Recharts用データ配列
**外部サービス依存**: PostgreSQL

### 複合処理-003: 年月日運計算
**トリガー**: 命式詳細ページ（P-003）ロード
**フロントエンドAPI**: `GET /api/saju/{id}/current`
**バックエンド内部処理**:
1. 現在日時取得
2. 年運計算（現在年の干支）
3. 月運計算（現在月の干支）
4. 日運計算（現在日の干支）
5. 各運の吉凶レベル判定（5段階）
**結果**: 現在の年運・月運・日運データ
**外部サービス依存**: lunar-python, CheonganMatrix, JijiMatrix

### 複合処理-004: ゲストデータ移行
**トリガー**: 新規登録時「ゲストデータを移行する」チェックON
**フロントエンドAPI**: `POST /api/saju/migrate`
**バックエンド内部処理**:
1. フロントエンドからLocalStorageデータ受信
2. 各命式データをバリデーション
3. user_idを付与
4. PostgreSQLに一括挿入
5. トランザクション管理（全成功または全失敗）
**結果**: 移行完了通知
**外部サービス依存**: PostgreSQL

---

## 7. 技術スタック

### フロントエンド
```yaml
フレームワーク: React 18
言語: TypeScript 5
UIライブラリ: MUI v6 (Material-UI)
グラフ: Recharts v3.3.0
状態管理: Zustand
ルーティング: React Router v6
データフェッチ: React Query (TanStack Query)
ビルドツール: Vite 5
ホスティング: Vercel

カスタムテーマ:
  - ゴールドカラーパレット（#D4AF37）
  - 五行カラーシステム
  - golden-peppaアニメーション統合
```

### バックエンド
```yaml
言語: Python 3.11+
フレームワーク: FastAPI 0.100+
ORM: SQLAlchemy 2.0
マイグレーション: Alembic
バリデーション: Pydantic v2
認証: FastAPI-Users + JWT
ホスティング: GCP Cloud Run

既存資産統合:
  - lunar-python（万年暦計算）
  - 210年節気データベース（JSON → PostgreSQL）
  - ドンサゴン分析エンジン
```

### データベース
```yaml
メインDB: PostgreSQL 15+ (Neon)
キャッシュ: Redis (Upstash, オプション)
```

### 開発環境
```yaml
Python: 3.11+
Node.js: 20.x LTS
パッケージマネージャ:
  - Python: Poetry
  - JavaScript: pnpm
コード品質:
  - Python: Black, Ruff, mypy
  - TypeScript: ESLint, Prettier
```

---

## 8. 必要な外部サービス・アカウント

### 必須サービス

| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| lunar-python | 万年暦計算ライブラリ | `pip install lunar-python` | 無料、1900-2100年対応 |
| Neon PostgreSQL | メインデータベース | https://neon.tech | 無料枠0.5GB、サーバーレス |
| Vercel | フロントエンドホスティング | https://vercel.com | 無料枠あり、自動デプロイ |
| GCP Cloud Run | バックエンドホスティング | https://cloud.google.com/run | 無料枠月2M req |
| GitHub | コード管理・CI/CD | https://github.com | 無料 |

### オプションサービス

| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| Upstash Redis | キャッシュ | https://upstash.com | 無料枠あり、初期不要 |
| Sentry | エラー監視 | https://sentry.io | 無料枠あり、本番後推奨 |

---

## 9. 今後の拡張予定

### Phase 2（中期）
- パスワードリセット機能
- メールアドレス変更機能
- 他のデザインテーマ追加
- 多言語対応（英語・韓国語）

### Phase 3（長期）
- 相性診断機能（2人の命式比較）
- 年運詳細分析
- 択日システム
- モバイルアプリ版（React Native）

---

## 付録：デザイン仕様

### ゴールドカラーパレット
```yaml
Primary Gold: #D4AF37
Light Gold: #F4E8C1
Dark Gold: #B8941C
Background: #FFFFFF
Secondary Background: #FAFAFA
```

### 五行カラーシステム
```yaml
木: #4CAF50（緑）
火: #F44336（赤）
土: #FFB300（黄/オレンジ）
金: #BDBDBD（グレー/白）
水: #424242（黒/ダークグレー）
```

### 吉凶カラーシステム
```yaml
大吉: #FFD700（ゴールド）
吉: #4CAF50（緑）
平: #9E9E9E（グレー）
凶: #FF9800（オレンジ）
大凶: #F44336（赤）
```

---

**作成日**: 2025年11月1日
**バージョン**: 1.0
**最終更新**: 2025年11月1日
